(function(a){a(document).ready(function(){function k(){var b=this,c=[function(c){var d=a.Deferred();return c.animate({top:b._position.bottom,opacity:"hide"},d.resolve),d.promise()},function(b){var c=a.Deferred();return b.fadeOut(1e3,c.resolve),c.promise()}];return c[Math.floor(Math.random()*c.length)]}function l(b){var c=this,d=this.options.effect==="random"?a.fn.textualizer.effects[g[Math.floor(Math.random()*g.length)]]:a.fn.textualizer.effects[this.options.effect],f=a.Deferred(),h=[];return a.each(b.chars,function(a,b){b.inserted||(b.domNode.show().css({left:b.pos.left,top:b.pos.top}).delay(Math.random()*e),d.call(c,b),h.push(b.domNode))}),a.when.apply(null,h).done(function(){f.resolve()}),f.promise()}var b=1e3,c=500,d=2e3,e=2e3,f=2e3;a.fn.textualizer=function(b,c){function e(b){var c=b.data("textualizer");if(!c){var e=[],f;if(d.length===1&&d[0]instanceof Array)e=d[0];else if(d.length===1&&typeof d[0]=="object")f=d[0];else if(d.length===2)e=d[0],f=d[1];else throw"textualizer: invalid argument(s)";f=a.extend({},a.fn.textualizer.defaults,f),c=new j(b,e,f),b.data("textualizer",c)}return c}var d=arguments,f=e(this);return typeof d[0]=="string"&&f[d[0]]&&f[d[0]].apply(f,Array.prototype.slice.call(d,1)),this},a.fn.textualizer.defaults={effect:"random",duration:500,rearrangeDuration:1e3},a.fn.textualizer.effects={none:function(a){this.container.append(a.domNode.show())},fadeIn:function(a){this.container.append(a.domNode.fadeIn(d))},slideLeft:function(a){a.domNode.appendTo(this.container).css({left:-1e3}).animate({left:a.pos.left},d)},slideTop:function(a){a.domNode.appendTo(this.container).css({top:-1e3}).animate({top:a.pos.top},d)}};var g=[];a.each(a.fn.textualizer.effects,function(a,b){a!=="none"&&g.push(a)});var h=function(){this.str="",this.chars=[]};h.prototype={get:function(a){for(var b=0,c=this.chars.length;b<c;b++){var d=this.chars[b];if(d.ch===a&&!d.used)return d.used=!0,d}return null},reset:function(){a.each(this.chars,function(a,b){b.inserted=!1,b.used=!1})}};var i=function(){this.ch=null,this.domNode=null,this.pos=null,this.used=!1,this.inserted=!1,this.visited=!1},j=function(b,c,d){this.options=d,this._parent=b.parent();var e=b.clone().removeAttr("id").appendTo(document.body),f;window.getComputedStyle?(styles=window.getComputedStyle(b[0],null),a.each(styles,function(a,b){e.css(b,styles.getPropertyValue(b))})):(styles=b[0].currentStyle,a.each(styles,function(a,b){e.css(a,b)})),e.css({position:"absolute",top:"-1000px"}),this.phantomContainer=a("<div />").css({position:"relative",visibility:"hidden"}).appendTo(e),b.css("overflow","hidden"),this.container=a("<div />").css("position","relative").appendTo(b),this._previous=null,this._position=this._parent.position(),this._position.bottom=this._position.top+this._parent.height(),this.blurbs=[],c&&c instanceof Array&&this.data(c)};j.prototype={data:function(a){this.stop(),this.list=a,this.blurbs=[]},start:function(){function d(c){if(b._pause)return;b._rotate(c).done(function(){setTimeout(function(){c===b.list.length-1&&(c=-1,a.each(b.blurbs,function(a,b){b.reset()})),c++,b._index=c,d(c)},b.options.duration)})}if(!this.list||this.list.length===0)return;var b=this,c=this._index||0;this._pause=!1,d(c)},stop:function(){this.pause(),this._previous=null,this._index=0,this.container.empty(),this.phantomContainer.empty()},pause:function(){this._pause=!0},_rotate:function(d){var e=a.Deferred(),g=this.blurbs[d];if(!g){var j=[],m,n,o,p;g=new h,g.str=this.list[d],this.blurbs.push(g);for(m=0,n=g.str.length;m<n;m++)o=g.str.charAt(m),o===""?this.phantomContainer.append(" "):(p=new i,p.ch=o,p.domNode=a("<span/>").text(o),this.phantomContainer.append(p.domNode),j.push(p));a.each(j,function(a,b){b.pos=b.domNode.position(),b.domNode=b.domNode.clone(),b.domNode.css({left:b.pos.left,top:b.pos.top,position:"absolute"}),g.chars.push(b)}),this.phantomContainer.html("")}if(this._previous){var q=this,r=[],s=[],t=[],u=k.call(this);a.each(this._previous.chars,function(b,c){var d=g.get(c.ch);if(d)d.domNode=c.domNode,d.inserted=!0,r.push(d);else{var e=a.Deferred();s.push(e),u(c.domNode.delay(Math.random()*f)).done(function(){c.domNode.remove(),e.resolve()})}}),a.when.apply(null,s).done(function(){setTimeout(function(){a.each(r,function(a,b){b.domNode.animate({left:b.pos.left,top:b.pos.top},q.options.rearrangeDuration),t.push(b.domNode)}),a.when.apply(null,t).done(function(){setTimeout(function(){l.call(q,g).done(function(){e.resolve()})},c)})},b)})}else l.call(this,g).done(function(){e.resolve()});return this._previous=g,e.promise()},destroy:function(){this.container.parent().removeData("textualizer").end().remove(),this.phantomContainer.remove()}}})})(jQuery)
